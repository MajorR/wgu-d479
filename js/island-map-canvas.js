(()=>{"use strict";document.addEventListener("DOMContentLoaded",(function(){const n=document.querySelector(".island-map"),e=document.getElementById("island-canvas"),t=e.getContext("2d"),i=new Image;i.src="img/island.svg",i.onerror=function(){console.error("Error loading SVG image. Trying to load a PNG fallback...")};let o,s,c=2,a=!1,d=0,l=0,w=!1;window.zoomScale=c,window.panX=d,window.panY=l,window.isPanning=a;let u=0,r={x:0,y:0};const h=235.57953,g=318.05115;function m(){const n=e.parentElement,i=n.clientWidth,o=n.clientHeight,s=window.devicePixelRatio||1;e.style.width=`${i}px`,e.style.height=`${o}px`,e.width=i*s,e.height=o*s,t.scale(s,s),1===c&&(d=0,l=0),v()}function v(){w||(w=!0,requestAnimationFrame(p))}function p(){w=!1;const n=window.devicePixelRatio||1,o=e.width/n,s=e.height/n;t.clearRect(0,0,o,s),t.fillStyle="#6397a8",t.fillRect(0,0,o,s),t.save();const a=o/2,u=s/2;t.translate(a+d,u+l),t.scale(c,c),i.complete&&t.drawImage(i,-117.789765,-159.025575,h,g),t.restore(),window.drawOverlays&&window.drawOverlays()}function f(n,e){const t=n.clientX-e.clientX,i=n.clientY-e.clientY;return Math.sqrt(t*t+i*i)}function L(n,e){return{x:(n.clientX+e.clientX)/2,y:(n.clientY+e.clientY)/2}}window.originalWidth=h,window.originalHeight=g,window.addEventListener("resize",m),m(),window.drawMap=v,i.onload=function(){v()},e.addEventListener("wheel",(function(t){t.preventDefault();const i=t.deltaY>0?.9:1.1;1.1===i?n.classList.add("zooming-in"):n.classList.add("zooming-out");const o=window.devicePixelRatio||1,s=e.width/o,a=e.height/o,w=e.getBoundingClientRect(),u=t.clientX-w.left,r=t.clientY-w.top,h=(u-s/2-d)/c,g=(r-a/2-l)/c,m=c*i;m>=1&&m<=60&&(c=m,window.zoomScale=c,d=u-s/2-h*c,l=r-a/2-g*c,window.panX=d,window.panY=l,v()),setTimeout((()=>{n.classList.remove("zooming-in"),n.classList.remove("zooming-out")}),300)})),e.addEventListener("mousedown",(function(e){0===e.button&&(e.preventDefault(),a=!0,window.isPanning=!0,o=e.clientX,s=e.clientY,n.classList.add("panning"))})),document.addEventListener("mousemove",(function(n){if(a){n.preventDefault();const e=n.clientX-o,t=n.clientY-s;d+=e,l+=t,window.panX=d,window.panY=l,o=n.clientX,s=n.clientY,v()}})),document.addEventListener("mouseup",(function(){a&&(a=!1,window.isPanning=!1,n.classList.remove("panning"))})),document.addEventListener("mouseleave",(function(){a&&(a=!1,window.isPanning=!1,n.classList.remove("panning"))})),e.addEventListener("touchstart",(function(e){e.preventDefault(),1===e.touches.length?(a=!0,window.isPanning=!0,o=e.touches[0].clientX,s=e.touches[0].clientY,n.classList.add("panning")):2===e.touches.length&&(a=!1,window.isPanning=!1,u=f(e.touches[0],e.touches[1]),r=L(e.touches[0],e.touches[1]),n.classList.add("zooming"))}),{passive:!1}),e.addEventListener("touchmove",(function(n){if(n.preventDefault(),1===n.touches.length&&a){const e=n.touches[0].clientX-o,t=n.touches[0].clientY-s;d+=e,l+=t,window.panX=d,window.panY=l,o=n.touches[0].clientX,s=n.touches[0].clientY,v()}else if(2===n.touches.length){const t=f(n.touches[0],n.touches[1]),i=L(n.touches[0],n.touches[1]);if(u>0){const n=t/u,o=window.devicePixelRatio||1,s=e.width/o,a=e.height/o,w=(i.x-s/2-d)/c,h=(i.y-a/2-l)/c,g=c*n;g>=1&&g<=60&&(c=g,window.zoomScale=c,d=i.x-s/2-w*c,l=i.y-a/2-h*c,window.panX=d,window.panY=l,v()),u=t,r=i}}}),{passive:!1}),e.addEventListener("touchend",(function(e){e.preventDefault(),0===e.touches.length?(a=!1,window.isPanning=!1,u=0,n.classList.remove("panning"),n.classList.remove("zooming")):1===e.touches.length&&(a=!0,window.isPanning=!0,o=e.touches[0].clientX,s=e.touches[0].clientY,u=0,n.classList.remove("zooming"),n.classList.add("panning"))}),{passive:!1}),e.addEventListener("touchcancel",(function(e){e.preventDefault(),a=!1,window.isPanning=!1,u=0,n.classList.remove("panning"),n.classList.remove("zooming")}),{passive:!1})}))})();