(()=>{"use strict";document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("map-overlays"),t=document.getElementById("place-details"),n=t.querySelector(".details-content"),o=document.getElementById("category-sidebar"),a=document.getElementById("filters-sidebar"),i=document.getElementById("filters-toggle-btn"),c=document.getElementById("filters-close-btn"),s=document.getElementById("filters-apply-btn"),r=document.getElementById("toggle-all-checkbox"),l=document.getElementById("island-svg");let d={},m={},u=new Set,g=new Set,p=!1,h=1,y=null,v={x:0,y:0,width:0,height:0};function f(){const e=document.createElement("style");e.textContent="\n      .island-map.zooming {\n        cursor: ns-resize !important;\n      }\n    ",document.head.appendChild(e),l.addEventListener("load",(function(){const e=l.contentDocument,t=e.querySelector("svg");if(e.addEventListener("contextmenu",(function(e){e.preventDefault()})),t){const e=t.getAttribute("viewBox").split(" ");y={x:parseFloat(e[0]),y:parseFloat(e[1]),width:parseFloat(e[2]),height:parseFloat(e[3])},v={...y};const n=document.querySelector(".island-map");t.addEventListener("mousedown",(function(e){2===e.button&&(p=!0,n.classList.add("zooming"),e.preventDefault())})),t.addEventListener("mouseup",(function(e){2===e.button&&(p=!1,n.classList.remove("zooming"))})),n.addEventListener("mousedown",(function(e){2===e.button&&(p=!0,n.classList.add("zooming"),e.preventDefault())})),n.addEventListener("mouseup",(function(e){2===e.button&&(p=!1,n.classList.remove("zooming"))})),document.addEventListener("mouseup",(function(e){2===e.button&&p&&(console.log("Global mouseup detected, resetting zoom state"),p=!1,n.classList.remove("zooming"))})),document.addEventListener("mousedown",(function(e){l.contains(e.target)||n.contains(e.target)||!p||(console.log("Click outside map detected, resetting zoom state"),p=!1,n.classList.remove("zooming"))}));let o=null;t.addEventListener("mousemove",(function(e){if(p){let t=0;void 0!==e.movementY?t=e.movementY:null!==o&&(t=e.clientY-o),o=e.clientY,0!==t&&(console.log("SVG mousemove, movementY:",t),b(1+-.01*t))}})),n.addEventListener("mousemove",(function(e){if(p){let t=0;void 0!==e.movementY?t=e.movementY:null!==o&&(t=e.clientY-o),o=e.clientY,0!==t&&(console.log("Container mousemove, movementY:",t),b(1+-.01*t))}else o=null})),t.addEventListener("mouseleave",(function(){})),n.addEventListener("mouseleave",(function(){p=!1,n.classList.remove("zooming")})),t.addEventListener("dblclick",(function(e){console.log("Double-click detected, resetting zoom"),E(),e.preventDefault()})),n.addEventListener("dblclick",(function(e){console.log("Double-click detected, resetting zoom"),E(),e.preventDefault()})),t.addEventListener("contextmenu",(function(e){e.preventDefault()})),n.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.getElementById("map-overlays").addEventListener("contextmenu",(function(e){e.preventDefault()}))}}))}function b(e){h*=e,h=Math.max(.5,Math.min(8,h));const t=y.width/h,n=y.height/h,o=y.x+y.width/2,a=y.y+y.height/2;v.x=o-t/2,v.y=a-n/2,v.width=t,v.height=n;try{const e=l.contentDocument;if(!e)return void console.error("SVG document not available");const t=e.querySelector("svg");if(!t)return void console.error("SVG element not found in document");const n=`${v.x.toFixed(2)} ${v.y.toFixed(2)} ${v.width.toFixed(2)} ${v.height.toFixed(2)}`;t.setAttribute("viewBox",n),console.log("Updated viewBox:",n)}catch(e){console.error("Error updating SVG viewBox:",e)}L()}function E(){try{console.log("Resetting zoom to original state"),h=1,v={...y};const e=l.contentDocument;if(!e)return void console.error("SVG document not available");const t=e.querySelector("svg");if(!t)return void console.error("SVG element not found in document");const n=`${y.x.toFixed(2)} ${y.y.toFixed(2)} ${y.width.toFixed(2)} ${y.height.toFixed(2)}`;t.setAttribute("viewBox",n),L(),console.log("Zoom reset complete")}catch(e){console.error("Error resetting zoom:",e)}}function L(){try{const e=document.querySelectorAll(".map-marker");if(!e||0===e.length)return void console.log("No markers found to update");console.log(`Updating ${e.length} markers with scale: ${1/h}`),e.forEach((e=>{try{if(e.dataset.originalX&&e.dataset.originalY){const t=parseFloat(e.dataset.originalX),n=parseFloat(e.dataset.originalY),o=(t-v.x)/v.width*100,a=(n-v.y)/v.height*100;e.style.left=`${o}%`,e.style.top=`${a}%`}else if(e.dataset.originalLeft&&e.dataset.originalTop){const t=parseFloat(e.dataset.originalLeft),n=parseFloat(e.dataset.originalTop),o=y.width/v.width,a=y.height/v.height,i=(v.x-y.x)/v.width*100,c=(v.y-y.y)/v.height*100,s=t*o-i,r=n*a-c;e.style.left=`${s}%`,e.style.top=`${r}%`}const t=1/h;e.style.transform=`translate(-50%, -50%) scale(${t})`,e.style.transformOrigin="center center",e.style.pointerEvents="auto"}catch(e){console.error("Error updating marker:",e)}}))}catch(e){console.error("Error in updateMarkerPositions:",e)}}function $(e){const t=e.target.checked,n=document.querySelectorAll(".category-toggle");document.querySelectorAll(".subcategory-toggle"),n.forEach((e=>{e.checked=t;const n=new Event("change",{bubbles:!0});e.dispatchEvent(n)})),r.indeterminate=!1,C()}function x(){const e=document.querySelectorAll(".category-toggle"),t=Array.from(e).filter((e=>e.checked)).length;0===t?(r.checked=!1,r.indeterminate=!1):t===e.length?(r.checked=!0,r.indeterminate=!1):(r.checked=!1,r.indeterminate=!0)}function k(e){const t=e.target.dataset.category,n=e.target.checked;document.querySelectorAll(`.subcategory-toggle[data-category="${t}"]`).forEach((e=>{e.checked=n;const o=e.dataset.subcategory;n?g.add(`${t}:${o}`):g.delete(`${t}:${o}`)})),n?u.add(t):u.delete(t),C(),x()}function w(e){const t=e.target.dataset.category,n=e.target.dataset.subcategory;e.target.checked?(g.add(`${t}:${n}`),u.add(t)):(g.delete(`${t}:${n}`),Array.from(g).some((e=>e.startsWith(`${t}:`)))||u.delete(t));const o=document.querySelector(`.category-toggle[data-category="${t}"]`);o&&(o.checked=Array.from(g).some((e=>e.startsWith(`${t}:`)))),C(),x()}function C(){document.querySelectorAll(".map-marker").forEach((e=>{const t=e.dataset.category,n=e.dataset.subcategory;g.has(`${t}:${n}`)?e.style.display="block":e.style.display="none"}))}function S(e){return e.charAt(0).toUpperCase()+e.slice(1)}Promise.all([fetch("data/map-overlays.yaml").then((e=>{if(!e.ok)throw new Error("Failed to load map data");return e.text()})),fetch("data/map-overlays-categories.yaml").then((e=>{if(!e.ok)throw new Error("Failed to load categories data");return e.text()}))]).then((([u,g])=>{d=jsyaml.load(u),m=jsyaml.load(g),o.innerHTML="",Object.keys(m).forEach((e=>{const t=m[e],n=document.createElement("div");n.className="category-item";const a=document.createElement("div");a.className="category-header";const i=document.createElement("input");i.type="checkbox",i.className="category-toggle",i.dataset.category=e,i.addEventListener("change",k),a.appendChild(i);const c=document.createElement("span");c.className="category-icon",c.textContent=t.icon,a.appendChild(c);const s=document.createElement("span");s.className="category-name",s.textContent=t.name,a.appendChild(s);const r=document.createElement("span");r.className="category-expand",r.innerHTML="&#9660;",a.appendChild(r),a.addEventListener("click",(function(e){if(e.target!==i){const e=n.querySelector(".subcategories");e.classList.contains("expanded"),e.classList.toggle("expanded"),r.classList.toggle("expanded")}})),n.appendChild(a);const l=document.createElement("div");l.className="subcategories",t.subcategories&&Object.keys(t.subcategories).forEach((n=>{const o=t.subcategories[n],a=document.createElement("div");a.className="subcategory-item";const i=document.createElement("input");i.type="checkbox",i.className="subcategory-toggle",i.dataset.category=e,i.dataset.subcategory=n,i.addEventListener("change",w),a.appendChild(i);const c=document.createElement("span");c.className="subcategory-icon",c.textContent=o.icon||t.icon,a.appendChild(c);const s=document.createElement("span");s.className="subcategory-name",s.textContent=o.name,a.appendChild(s),l.appendChild(a)})),n.appendChild(l),o.appendChild(n)})),e.innerHTML="",Object.keys(d).forEach((o=>{d[o].forEach((o=>{!function(o){const a=document.createElement("div");a.className=`map-marker ${o.category}`,a.dataset.category=o.category,a.dataset.subcategory=o.sub_category,a.dataset.name=o.name;const i=l.contentDocument;if(i){const e=i.querySelector("svg");if(e){const t=e.getAttribute("viewBox").split(" "),n=parseFloat(t[0]),i=parseFloat(t[1]),c=parseFloat(t[2]),s=parseFloat(t[3]),r=c*o.coordinates.left/100,l=s*o.coordinates.top/100;a.dataset.originalX=r,a.dataset.originalY=l;const d=(r-n)/c*100,m=(l-i)/s*100;a.style.left=`${d}%`,a.style.top=`${m}%`}else a.style.left=`${o.coordinates.left}%`,a.style.top=`${o.coordinates.top}%`,a.dataset.originalLeft=o.coordinates.left,a.dataset.originalTop=o.coordinates.top}else a.style.left=`${o.coordinates.left}%`,a.style.top=`${o.coordinates.top}%`,a.dataset.originalLeft=o.coordinates.left,a.dataset.originalTop=o.coordinates.top;if(m[o.category]){const e=m[o.category];a.style.backgroundColor=e.color;const t=document.createElement("span");t.className="marker-icon",e.subcategories&&e.subcategories[o.sub_category]&&e.subcategories[o.sub_category].icon?t.textContent=e.subcategories[o.sub_category].icon:t.textContent=e.icon,a.appendChild(t)}a.addEventListener("click",(()=>{!function(e){t.querySelector("h3").textContent=e.name;let o=`\n      <div class="detail-description">\n        <h4>Description</h4>\n        <p>${e.description}</p>\n      </div>\n\n      <div class="detail-item">\n        <h4>Category</h4>\n        <p>${S(e.category)} - ${S(e.sub_category.replace(/-/g," "))}</p>\n      </div>\n\n      <div class="detail-item">\n        <h4>Address</h4>\n        <p>${e.address}</p>\n      </div>\n    `;e.operating_times&&(o+=`\n        <div class="detail-item">\n          <h4>Operating Times</h4>\n          <p>${e.operating_times}</p>\n        </div>\n      `),e.phone&&(o+=`\n        <div class="detail-item">\n          <h4>Phone</h4>\n          <p>${e.phone}</p>\n        </div>\n      `),e.website&&(o+=`\n        <div class="detail-item">\n          <h4>Website</h4>\n          <p><a href="${e.website}" target="_blank">${e.website}</a></p>\n        </div>\n      `),e.pricing&&(o+=`\n        <div class="detail-item">\n          <h4>Pricing</h4>\n          <p>${e.pricing}</p>\n        </div>\n      `),e.details&&(o+=`\n        <div class="detail-item detail-description">\n          <h4>Details</h4>\n          <p>${e.details}</p>\n        </div>\n      `),e.menu&&(o+=`\n        <div class="detail-item">\n          <h4>Menu</h4>\n          <p><a href="${e.menu}" target="_blank">View Menu</a></p>\n        </div>\n      `),n.innerHTML=o,t.scrollIntoView({behavior:"smooth",block:"nearest"})}(o)})),e.appendChild(a)}(o)}))})),C(),t.querySelector("h3").textContent="Select a location to view details",n.innerHTML='\n      <div class="detail-description">\n        <p>Click on any marker on the map to view details about that location.</p>\n        <p>Use the checkboxes to show or hide different categories of places.</p>\n        <p><strong>Zoom Tips:</strong></p>\n        <ul>\n          <li>Hold the right mouse button and move up/down to zoom in/out of the map.</li>\n          <li>Double-click anywhere on the map to reset the zoom level.</li>\n        </ul>\n      </div>\n    ',i.addEventListener("click",(function(){a.classList.add("active"),document.body.style.overflow="hidden"})),c.addEventListener("click",(function(){a.classList.remove("active"),document.body.style.overflow=""})),s.addEventListener("click",(function(){a.classList.remove("active"),document.body.style.overflow=""})),r.addEventListener("change",$),x(),l.contentDocument&&"complete"===l.contentDocument.readyState?(console.log("SVG already loaded, initializing zoom functionality"),f()):(console.log("Waiting for SVG to load before initializing zoom"),l.addEventListener("load",(function(){console.log("SVG loaded, initializing zoom functionality"),f()})))})).catch((e=>{console.error("Error loading data:",e),t.innerHTML=`<div class="error">Error loading data: ${e.message}</div>`,o.innerHTML=`<div class="error">Error loading categories: ${e.message}</div>`}))}))})();